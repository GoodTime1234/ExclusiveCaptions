<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Processing Login...</title>
</head>
<body>
    <h1>Processing Login...</h1>
    <p>Please wait while we complete the authentication process.</p>

    <script>
        // This function will run once the page is loaded
        window.onload = function () {
            // Step 1: Get the query parameters from the URL
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');  // This is the authorization code
            const state = urlParams.get('state');  // This is the state parameter, if you're using it

            // Step 2: Check if the code exists in the URL
            if (code) {
                // Now you need to send this `code` to Patreon to get the access token
                exchangeCodeForToken(code);
            } else {
                // If there's no code, log an error
                console.error("Authorization code is missing in the URL.");
                alert("Something went wrong with the login process.");
            }
        };

        function exchangeCodeForToken(code) {
            // Step 3: Make a POST request to Patreon to exchange the code for an access token
            const clientId = 'YOUR_PATREON_CLIENT_ID';
            const clientSecret = 'YOUR_PATREON_CLIENT_SECRET';
            const redirectUri = 'https://goodtime1234.github.io/ExclusiveCaptions/callback.html';

            // Construct the form data for the token request
            const formData = new FormData();
            formData.append('grant_type', 'authorization_code');
            formData.append('code', code);
            formData.append('client_id', clientId);
            formData.append('client_secret', clientSecret);
            formData.append('redirect_uri', redirectUri);

            // Send the request to Patreon to exchange the code for an access token
            fetch('https://www.patreon.com/api/oauth2/token', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                // Step 4: Handle the access token (store it, etc.)
                console.log("Access Token:", data.access_token);

                // After you have the token, you can use it to make API requests
                // Example: redirect the user to a page where they can access exclusive content
                window.location.href = '/ExclusiveCaptions/exclusive.html';  // Redirect to exclusive content page
            })
            .catch(error => {
                console.error("Error exchanging code for token:", error);
                alert("Something went wrong while processing your login.");
            });
        }
    </script>
</body>
</html>
